<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Shred or Dead</title>

    <!-- Social sharing meta tags -->
    <meta name="description" content="Outrun the beast. Shred the mountain. A synthwave snowboarding survival game.">
    <meta property="og:title" content="Shred or Dead">
    <meta property="og:description" content="Outrun the beast. Shred the mountain. A synthwave snowboarding survival game.">
    <meta property="og:image" content="https://kingmadellc.github.io/ShredOrDead/assets/social-preview.png">
    <meta property="og:url" content="https://kingmadellc.github.io/ShredOrDead/">
    <meta property="og:type" content="website">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Shred or Dead">
    <meta name="twitter:description" content="Outrun the beast. Shred the mountain. A synthwave snowboarding survival game.">
    <meta name="twitter:image" content="https://kingmadellc.github.io/ShredOrDead/assets/social-preview.png">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        /* ============================================
           CSS Custom Properties
           ============================================ */
        :root {
            --cyan: #00ffff;
            --magenta: #ff00ff;
            --hot-pink: #ff1493;
            --purple-dark: #1a0a2e;
            --purple-mid: #2d1b4e;
            --coral: #ff6b6b;
            --white: #ffffff;
            --font-pixel: 'Press Start 2P', monospace;
        }

        /* ============================================
           Base Styles
           ============================================ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #0a0a1a;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-family: var(--font-pixel);
            overflow: hidden;
        }

        body.menu-active #gameCanvas {
            display: none;
        }

        #game-container {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* When menu is active, hide game container styling so start screen can fill viewport */
        body.menu-active #game-container {
            display: block;
            width: 100vw;
            height: 100vh;
        }

        #gameCanvas {
            border: 4px solid var(--cyan);
            box-shadow:
                0 0 20px var(--cyan),
                0 0 40px var(--magenta),
                inset 0 0 20px rgba(0, 255, 255, 0.1);
            image-rendering: pixelated;
            image-rendering: crisp-edges;
            transition: opacity 0.3s ease;
            position: relative;
            z-index: 1;
            /* iOS touch handling */
            touch-action: none;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }

        /* In fullscreen mode, make the game canvas fill the screen */
        body.fullscreen-mode #gameCanvas {
            position: fixed;
            top: 0;
            left: 0;
            z-index: 50;
            border: none;
            box-shadow: none;
        }

        /* Auto fullscreen on mobile devices */
        @media (max-width: 768px), (pointer: coarse) {
            body:not(.menu-active) #game-container {
                position: fixed;
                top: 0;
                left: 0;
                width: 100vw;
                height: 100vh;
                display: flex;
                justify-content: center;
                align-items: center;
                background: #0a0a1a;
            }

            body:not(.menu-active) #gameCanvas {
                border: none;
                box-shadow: none;
                max-width: 100vw;
                max-height: 100vh;
            }
        }


        /* ============================================
           Start Screen Modal - Fills the entire viewport
           ============================================ */
        #startScreen {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100vw !important;
            height: 100vh !important;
            background-color: var(--purple-dark);
            background-image: url('assets/snowfree-keyart.png');
            background-size: cover;
            background-position: center;
            border: none !important;
            border-radius: 0 !important;
            box-shadow: none !important;
            z-index: 100;
            overflow: hidden;
            margin: 0 !important;
            padding: 0 !important;
            max-width: none !important;
            max-height: none !important;
        }

        /* Content overlay fills the start screen */
        #startScreen .content-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(180deg,
                rgba(26, 10, 46, 0.7) 0%,
                rgba(26, 10, 46, 0.3) 25%,
                rgba(26, 10, 46, 0.2) 50%,
                rgba(26, 10, 46, 0.6) 70%,
                rgba(26, 10, 46, 0.95) 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            padding: 5vh 30px 6vh;
        }

        /* Snow Canvas - background ambient snow */
        #snowCanvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        /* ============================================
           Title Section with Wordmark Logo
           ============================================ */
        .title-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            position: relative;
            overflow: visible;
            margin-top: -15px;
            margin-bottom: 0;
            z-index: 2;
        }

        /* Blizzard particle canvas - positioned around logo */
        #blizzardCanvas {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 750px;
            height: 450px;
            pointer-events: none;
            z-index: 4;
            transition: width 0.3s ease, height 0.3s ease;
        }

        /* Wordmark logo image */
        #game-logo-img {
            width: 92%;
            max-width: 600px;
            height: auto;
            image-rendering: -webkit-optimize-contrast;
            image-rendering: crisp-edges;
            filter: drop-shadow(0 0 20px rgba(0, 255, 255, 0.9))
                    drop-shadow(0 0 40px rgba(255, 0, 255, 0.7))
                    drop-shadow(0 0 70px rgba(0, 255, 255, 0.5))
                    drop-shadow(0 0 100px rgba(255, 0, 255, 0.3));
            animation: logo-neon-glow 1.5s ease-in-out infinite,
                       logo-flicker 0.1s steps(2) infinite,
                       logo-pulse 3s ease-in-out infinite;
            position: relative;
            z-index: 3;
        }

        /* Screen reader fallback */
        .visually-hidden {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        /* Neon glow breathing animation - cyan/magenta */
        @keyframes logo-neon-glow {
            0%, 100% {
                filter: drop-shadow(0 0 15px rgba(0, 255, 255, 0.9))
                        drop-shadow(0 0 35px rgba(255, 0, 255, 0.7))
                        drop-shadow(0 0 60px rgba(0, 255, 255, 0.4))
                        drop-shadow(0 0 90px rgba(255, 0, 255, 0.25));
            }
            25% {
                filter: drop-shadow(0 0 25px rgba(0, 255, 255, 1))
                        drop-shadow(0 0 50px rgba(255, 0, 255, 0.85))
                        drop-shadow(0 0 80px rgba(0, 255, 255, 0.6))
                        drop-shadow(0 0 120px rgba(255, 0, 255, 0.4));
            }
            50% {
                filter: drop-shadow(0 0 30px rgba(255, 0, 255, 1))
                        drop-shadow(0 0 60px rgba(0, 255, 255, 0.9))
                        drop-shadow(0 0 100px rgba(255, 0, 255, 0.7))
                        drop-shadow(0 0 150px rgba(0, 255, 255, 0.5));
            }
            75% {
                filter: drop-shadow(0 0 22px rgba(0, 255, 255, 1))
                        drop-shadow(0 0 45px rgba(255, 0, 255, 0.8))
                        drop-shadow(0 0 75px rgba(0, 255, 255, 0.55))
                        drop-shadow(0 0 110px rgba(255, 0, 255, 0.35));
            }
        }

        /* Subtle flicker for neon realism */
        @keyframes logo-flicker {
            0%, 100% { opacity: 1; }
            25% { opacity: 0.95; }
            50% { opacity: 0.98; }
            75% { opacity: 0.92; }
        }

        /* Slow pulse/scale animation */
        @keyframes logo-pulse {
            0%, 100% {
                transform: scale(1) translateY(0);
            }
            50% {
                transform: scale(1.015) translateY(-2px);
            }
        }

        /* Frost shimmer effect above logo */
        .title-section::before {
            content: '';
            position: absolute;
            top: 30%;
            left: 5%;
            right: 5%;
            height: 100px;
            background: linear-gradient(180deg,
                transparent 0%,
                rgba(0, 255, 255, 0.06) 20%,
                rgba(255, 255, 255, 0.1) 40%,
                rgba(255, 0, 255, 0.08) 60%,
                rgba(0, 255, 255, 0.05) 80%,
                transparent 100%);
            animation: frost-shimmer 2s ease-in-out infinite;
            pointer-events: none;
            z-index: 1;
            filter: blur(8px);
        }

        @keyframes frost-shimmer {
            0%, 100% {
                transform: scaleY(1) translateY(0);
                opacity: 0.5;
            }
            30% {
                transform: scaleY(1.2) translateY(-8px);
                opacity: 0.8;
            }
            60% {
                transform: scaleY(0.9) translateY(4px);
                opacity: 0.6;
            }
        }

        /* Ambient glow beneath logo - icy */
        .title-section::after {
            content: '';
            position: absolute;
            bottom: 20px;
            left: 10%;
            right: 10%;
            height: 60px;
            background: radial-gradient(ellipse at center,
                rgba(0, 255, 255, 0.5) 0%,
                rgba(255, 0, 255, 0.3) 30%,
                rgba(0, 255, 255, 0.2) 50%,
                rgba(255, 0, 255, 0.1) 70%,
                transparent 90%);
            animation: underglow-pulse 2s ease-in-out infinite;
            pointer-events: none;
            z-index: 0;
            filter: blur(15px);
        }

        @keyframes underglow-pulse {
            0%, 100% {
                opacity: 0.6;
                transform: scaleX(1) scaleY(1);
            }
            50% {
                opacity: 0.9;
                transform: scaleX(1.1) scaleY(1.15);
            }
        }

        /* Hide old text logo elements */
        .game-logo {
            display: none;
        }

        /* Tagline - positioned above menu buttons */
        .tagline {
            font-size: 12px;
            color: var(--white);
            letter-spacing: 3px;
            text-align: center;
            white-space: nowrap;
            text-shadow:
                0 0 10px rgba(255, 255, 255, 0.9),
                0 0 20px rgba(0, 255, 255, 0.7),
                0 0 40px rgba(255, 0, 255, 0.5),
                2px 2px 4px rgba(0, 0, 0, 0.8);
            position: relative;
            z-index: 5;
            margin-bottom: 20px;
            padding: 12px 28px;
            background: rgba(26, 10, 46, 0.8);
            border-radius: 8px;
            border: 1px solid rgba(0, 255, 255, 0.4);
            animation: tagline-pulse 2s ease-in-out infinite;
        }

        @keyframes tagline-pulse {
            0%, 100% {
                text-shadow:
                    0 0 10px rgba(255, 255, 255, 0.9),
                    0 0 20px rgba(0, 255, 255, 0.7),
                    0 0 40px rgba(255, 0, 255, 0.5),
                    2px 2px 4px rgba(0, 0, 0, 0.8);
            }
            50% {
                text-shadow:
                    0 0 15px rgba(255, 255, 255, 1),
                    0 0 30px rgba(0, 255, 255, 0.9),
                    0 0 50px rgba(255, 0, 255, 0.7),
                    2px 2px 4px rgba(0, 0, 0, 0.8);
            }
        }

        /* ============================================
           Menu Buttons
           ============================================ */
        .menu-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 18px;
            z-index: 2;
            width: 100%;
            max-width: 450px;
        }

        .menu-btn {
            font-family: var(--font-pixel);
            font-size: 16px;
            padding: 20px 40px;
            border-radius: 10px;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 3px;
            transition: all 0.2s ease;
            outline: none;
            width: 100%;
        }

        .menu-btn:focus {
            outline: 3px solid var(--white);
            outline-offset: 3px;
        }

        .menu-btn:active {
            transform: translateY(2px) scale(0.97);
        }

        /* Primary Button - Cyan */
        .btn-primary {
            background: linear-gradient(180deg, var(--cyan) 0%, #00cccc 100%);
            color: var(--purple-dark);
            border: 3px solid rgba(0, 255, 255, 0.8);
            box-shadow:
                0 0 20px rgba(0, 255, 255, 0.5),
                0 4px 15px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
            font-size: 18px;
            font-weight: bold;
            animation: btn-primary-pulse 2s ease-in-out infinite;
        }

        @keyframes btn-primary-pulse {
            0%, 100% {
                box-shadow:
                    0 0 20px rgba(0, 255, 255, 0.5),
                    0 4px 15px rgba(0, 0, 0, 0.3),
                    inset 0 1px 0 rgba(255, 255, 255, 0.3);
            }
            50% {
                box-shadow:
                    0 0 30px rgba(0, 255, 255, 0.7),
                    0 0 50px rgba(0, 255, 255, 0.3),
                    0 4px 15px rgba(0, 0, 0, 0.3),
                    inset 0 1px 0 rgba(255, 255, 255, 0.3);
            }
        }

        .btn-primary:hover {
            background: linear-gradient(180deg, #66ffff 0%, #33ffff 100%);
            transform: translateY(-4px) scale(1.02);
            box-shadow:
                0 0 40px rgba(0, 255, 255, 0.8),
                0 0 60px rgba(0, 255, 255, 0.5),
                0 8px 25px rgba(0, 0, 0, 0.4);
            animation: none;
        }

        .btn-primary:active {
            transform: translateY(-1px) scale(0.98);
            box-shadow:
                0 0 25px rgba(0, 255, 255, 0.6),
                0 2px 10px rgba(0, 0, 0, 0.3);
        }

        /* Secondary Buttons Row */
        .button-row {
            display: flex;
            gap: 15px;
            width: 100%;
        }

        .btn-secondary {
            background: linear-gradient(180deg, rgba(255, 0, 255, 0.2) 0%, rgba(255, 0, 255, 0.1) 100%);
            color: var(--white);
            border: 2px solid rgba(255, 0, 255, 0.6);
            box-shadow:
                0 0 15px rgba(255, 0, 255, 0.3),
                0 3px 10px rgba(0, 0, 0, 0.3);
            font-size: 14px;
            padding: 18px 28px;
            flex: 1;
            position: relative;
            overflow: hidden;
        }

        .btn-secondary::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 0, 255, 0.2), transparent);
            transition: left 0.5s ease;
        }

        .btn-secondary:hover::before {
            left: 100%;
        }

        .btn-secondary:hover {
            background: linear-gradient(180deg, rgba(255, 0, 255, 0.4) 0%, rgba(255, 0, 255, 0.25) 100%);
            border-color: var(--magenta);
            transform: translateY(-3px) scale(1.02);
            box-shadow:
                0 0 30px rgba(255, 0, 255, 0.6),
                0 0 50px rgba(255, 0, 255, 0.3),
                0 6px 20px rgba(0, 0, 0, 0.4);
            color: #fff;
        }

        .btn-secondary:active {
            transform: translateY(-1px) scale(0.98);
        }

        /* High Score Display */
        .high-score-display {
            font-size: 14px;
            color: var(--cyan);
            text-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
            margin-top: 15px;
        }

        .high-score-display span {
            color: var(--white);
        }

        /* Gamepad focus highlight */
        .gamepad-focus {
            outline: 3px solid var(--cyan) !important;
            outline-offset: 3px !important;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.6), 0 0 40px rgba(0, 255, 255, 0.2) !important;
        }

        /* Touch-friendly: ensure all buttons have sufficient tap target */
        .mode-btn,
        .menu-btn,
        .corner-btn,
        .submenu button,
        #slalomResults button,
        #slalomResults .menu-btn {
            -webkit-tap-highlight-color: rgba(0, 255, 255, 0.2);
            touch-action: manipulation;
            user-select: none;
            -webkit-user-select: none;
        }

        /* Mode Selector */
        .mode-selector {
            display: flex;
            gap: 12px;
            width: 100%;
        }

        .mode-btn {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            padding: 14px 10px;
            border-radius: 10px;
            cursor: pointer;
            font-family: var(--font-pixel);
            transition: all 0.2s ease;
            outline: none;
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.05) 0%, rgba(255, 255, 255, 0.02) 100%);
            border: 2px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.3);
        }

        .mode-btn:hover {
            border-color: rgba(0, 255, 255, 0.5);
            transform: translateY(-2px);
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.2), 0 5px 15px rgba(0, 0, 0, 0.4);
        }

        .mode-btn:active {
            transform: translateY(1px) scale(0.97);
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.3), 0 2px 5px rgba(0, 0, 0, 0.3);
        }

        .mode-btn:focus-visible {
            outline: 3px solid var(--cyan);
            outline-offset: 3px;
        }

        .mode-btn.mode-active {
            background: linear-gradient(180deg, rgba(0, 255, 255, 0.15) 0%, rgba(0, 255, 255, 0.05) 100%);
            border: 2px solid rgba(0, 255, 255, 0.8);
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.4), 0 0 40px rgba(0, 255, 255, 0.1), 0 3px 10px rgba(0, 0, 0, 0.3);
        }

        .mode-btn .mode-icon {
            font-size: 24px;
            line-height: 1;
        }

        .mode-btn .mode-name {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.5);
            letter-spacing: 3px;
        }

        .mode-btn.mode-active .mode-name {
            color: var(--cyan);
            text-shadow: 0 0 8px rgba(0, 255, 255, 0.5);
        }

        .mode-btn .mode-desc {
            font-size: 7px;
            color: rgba(255, 255, 255, 0.35);
            letter-spacing: 1px;
            text-align: center;
            line-height: 1.4;
        }

        .mode-btn.mode-active .mode-desc {
            color: rgba(255, 255, 255, 0.6);
        }

        /* Slalom Results Screen */
        #slalomResults {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 200;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #slalomResults .slalom-results-overlay {
            background: linear-gradient(180deg, rgba(10, 10, 26, 0.95) 0%, rgba(26, 10, 46, 0.98) 100%);
            border: 3px solid var(--cyan);
            border-radius: 12px;
            padding: 30px 40px;
            text-align: center;
            box-shadow: 0 0 40px rgba(0, 255, 255, 0.4), 0 0 80px rgba(0, 255, 255, 0.1);
            max-width: 400px;
            width: 90%;
        }

        #slalomResults h2 {
            font-family: var(--font-pixel);
            font-size: 20px;
            color: var(--cyan);
            text-shadow: 0 0 15px rgba(0, 255, 255, 0.7);
            margin-bottom: 24px;
            letter-spacing: 3px;
        }

        .slalom-stats {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 28px;
        }

        .slalom-stat-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-family: var(--font-pixel);
            font-size: 11px;
            padding: 6px 0;
        }

        .slalom-stat-label {
            color: rgba(255, 255, 255, 0.6);
            letter-spacing: 2px;
        }

        .slalom-stat-value {
            color: var(--white);
            text-shadow: 0 0 8px rgba(0, 255, 255, 0.3);
        }

        .slalom-stat-value.penalty {
            color: var(--coral);
        }

        .slalom-stat-value.best {
            color: var(--cyan);
        }

        .slalom-stat-row.final {
            border-top: 1px solid rgba(0, 255, 255, 0.3);
            padding-top: 12px;
            margin-top: 4px;
        }

        .slalom-stat-row.final .slalom-stat-label {
            color: var(--cyan);
            font-size: 13px;
        }

        .slalom-stat-row.final .slalom-stat-value {
            font-size: 16px;
            color: var(--white);
            text-shadow: 0 0 12px rgba(0, 255, 255, 0.6);
        }

        .slalom-new-best {
            font-family: var(--font-pixel);
            font-size: 10px;
            color: var(--cyan);
            text-shadow: 0 0 10px rgba(0, 255, 255, 0.8);
            letter-spacing: 2px;
            margin-bottom: 16px;
            animation: tagline-pulse 1s ease-in-out infinite;
        }

        #slalomResults .button-row {
            display: flex;
            gap: 12px;
            width: 100%;
        }

        #slalomResults .menu-btn {
            font-size: 12px;
            padding: 14px 20px;
            flex: 1;
            min-width: 0;
        }

        /* Press Space Hint */
        .press-space {
            font-size: 12px;
            color: var(--cyan);
            opacity: 0.9;
            animation: space-blink 1.5s ease-in-out infinite;
            margin-top: 20px;
            text-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
            letter-spacing: 3px;
        }

        @keyframes space-blink {
            0%, 100% { opacity: 0.9; transform: translateY(0); }
            50% { opacity: 0.4; transform: translateY(2px); }
        }

        /* CRT scanline effect overlay */
        #startScreen::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: repeating-linear-gradient(
                0deg,
                transparent,
                transparent 2px,
                rgba(0, 0, 0, 0.1) 2px,
                rgba(0, 0, 0, 0.1) 4px
            );
            pointer-events: none;
            z-index: 1000;
            opacity: 0.3;
        }

        /* Subtle vignette for focus */
        .content-overlay::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(
                ellipse at center,
                transparent 50%,
                rgba(0, 0, 0, 0.4) 100%
            );
            pointer-events: none;
            z-index: 0;
        }

        /* ============================================
           Submenus (How To Play, High Scores)
           ============================================ */
        .submenu {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(26, 10, 46, 0.98);
            z-index: 10;
            padding: 30px 25px;
            overflow-y: auto;
        }

        .submenu.active {
            display: flex;
            flex-direction: column;
        }

        .submenu h2 {
            font-size: 18px;
            color: var(--cyan);
            text-align: center;
            margin-bottom: 25px;
            text-shadow: 0 0 20px var(--cyan);
        }

        .submenu-content {
            flex: 1;
            overflow-y: auto;
        }

        .submenu-section {
            margin-bottom: 25px;
        }

        .submenu-section h3 {
            font-size: 11px;
            color: var(--magenta);
            margin-bottom: 10px;
            text-shadow: 0 0 10px rgba(255, 0, 255, 0.5);
        }

        .submenu-section p,
        .submenu-section li {
            font-size: 9px;
            color: var(--white);
            line-height: 1.8;
            opacity: 0.9;
        }

        .submenu-section ul {
            list-style: none;
            padding-left: 0;
        }

        .submenu-section li {
            margin-bottom: 8px;
            padding-left: 15px;
            position: relative;
        }

        .submenu-section li::before {
            content: ">";
            position: absolute;
            left: 0;
            color: var(--cyan);
        }

        .control-key {
            display: inline-block;
            background: rgba(0, 255, 255, 0.2);
            border: 1px solid var(--cyan);
            padding: 3px 8px;
            border-radius: 4px;
            margin-right: 8px;
            font-size: 8px;
        }

        /* High Scores List */
        .scores-list {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .score-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: rgba(0, 255, 255, 0.1);
            border: 2px solid rgba(0, 255, 255, 0.3);
            border-radius: 8px;
        }

        .score-label {
            font-size: 10px;
            color: var(--magenta);
        }

        .score-value {
            font-size: 14px;
            color: var(--cyan);
            text-shadow: 0 0 10px var(--cyan);
        }

        /* Back Button */
        .btn-back {
            margin-top: auto;
            padding-top: 20px;
        }

        .btn-back button {
            font-family: var(--font-pixel);
            font-size: 10px;
            padding: 12px 24px;
            background: transparent;
            color: var(--white);
            border: 2px solid rgba(255, 255, 255, 0.4);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            width: 100%;
        }

        .btn-back button:hover {
            border-color: var(--cyan);
            color: var(--cyan);
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.3);
        }

        /* Button focus states for keyboard navigation */
        .menu-btn:focus-visible {
            outline: 3px solid var(--white);
            outline-offset: 4px;
            animation: focus-pulse 0.5s ease-out;
        }

        @keyframes focus-pulse {
            0% { outline-offset: 0; }
            100% { outline-offset: 4px; }
        }

        /* ============================================
           Corner Buttons (Settings & Fullscreen)
           ============================================ */
        .corner-buttons {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 12px;
            z-index: 1500;
        }

        .corner-btn {
            padding: 12px 14px;
            font-size: 22px;
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            color: var(--white);
        }

        .corner-btn:hover {
            background: rgba(0, 255, 255, 0.3);
            border-color: var(--cyan);
        }

        .corner-settings-btn:hover {
            transform: rotate(45deg);
        }

        .corner-fullscreen-btn:hover {
            transform: scale(1.1);
        }

        /* ============================================
           Settings Menu
           ============================================ */
        #settingsMenu {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            z-index: 2000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }

        #settingsMenu.active {
            display: flex;
        }

        #settingsMenu .settings-overlay {
            background: linear-gradient(180deg, rgba(26, 10, 46, 0.98) 0%, rgba(15, 10, 30, 0.99) 100%);
            padding: 30px 40px;
            border-radius: 12px;
            text-align: left;
            border: 3px solid var(--cyan);
            box-shadow:
                0 0 60px rgba(0, 255, 255, 0.4),
                0 0 100px rgba(255, 0, 255, 0.2);
            max-width: 420px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        /* Settings menu scales up in fullscreen */
        body.fullscreen-mode #settingsMenu .settings-overlay {
            max-width: 600px;
            padding: 40px 60px;
        }

        body.fullscreen-mode #settingsMenu h2 {
            font-size: 32px;
            margin-bottom: 30px;
        }

        body.fullscreen-mode #settingsMenu h3 {
            font-size: 14px;
            margin: 25px 0 15px 0;
        }

        body.fullscreen-mode .setting-row {
            margin: 15px 0;
            padding: 12px 0;
        }

        body.fullscreen-mode .setting-row label {
            font-size: 13px;
        }

        body.fullscreen-mode .setting-row select,
        body.fullscreen-mode .setting-row button {
            font-size: 12px;
            padding: 10px 18px;
        }

        body.fullscreen-mode .setting-row input[type="checkbox"] {
            width: 26px;
            height: 26px;
        }

        body.fullscreen-mode .settings-buttons button {
            font-size: 14px;
            padding: 16px 32px;
        }

        #settingsMenu h2 {
            font-family: var(--font-pixel);
            font-size: 24px;
            color: var(--cyan);
            margin-bottom: 20px;
            text-align: center;
            text-shadow: 0 0 20px rgba(0, 255, 255, 0.6);
            letter-spacing: 4px;
        }

        #settingsMenu h3 {
            font-family: var(--font-pixel);
            font-size: 11px;
            color: var(--magenta);
            margin: 20px 0 10px 0;
            text-transform: uppercase;
            letter-spacing: 2px;
            border-bottom: 1px solid rgba(255, 0, 255, 0.3);
            padding-bottom: 5px;
        }

        .settings-section {
            margin-bottom: 15px;
        }

        .setting-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 10px 0;
            padding: 8px 0;
        }

        .setting-row label {
            font-family: var(--font-pixel);
            color: var(--white);
            font-size: 10px;
            opacity: 0.9;
        }

        .setting-row select,
        .setting-row button {
            padding: 6px 12px;
            font-family: var(--font-pixel);
            font-size: 9px;
            background: rgba(0, 255, 255, 0.1);
            color: var(--white);
            border: 2px solid var(--cyan);
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .setting-row select:hover,
        .setting-row button:hover {
            background: rgba(0, 255, 255, 0.25);
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.3);
        }

        .setting-row select {
            min-width: 140px;
        }

        .setting-row input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: var(--cyan);
        }

        .setting-row input[type="range"] {
            width: 100px;
            accent-color: var(--cyan);
            cursor: pointer;
        }

        .setting-row span {
            font-family: var(--font-pixel);
            color: var(--cyan);
            font-size: 9px;
            min-width: 35px;
            text-align: right;
        }

        .setting-row .device-info {
            font-size: 8px;
            color: rgba(255, 255, 255, 0.5);
        }

        .settings-buttons {
            display: flex;
            gap: 15px;
            margin-top: 25px;
            justify-content: center;
        }

        .settings-buttons button {
            font-family: var(--font-pixel);
            font-size: 10px;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .settings-buttons .btn-back {
            background: transparent;
            color: var(--white);
            border: 2px solid rgba(255, 255, 255, 0.4);
        }

        .settings-buttons .btn-back:hover {
            border-color: var(--cyan);
            color: var(--cyan);
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.3);
        }

        .settings-buttons .btn-reset {
            background: rgba(255, 0, 255, 0.2);
            color: var(--magenta);
            border: 2px solid rgba(255, 0, 255, 0.4);
        }

        .settings-buttons .btn-reset:hover {
            background: rgba(255, 0, 255, 0.35);
            border-color: var(--magenta);
            box-shadow: 0 0 15px rgba(255, 0, 255, 0.3);
        }

        /* ============================================
           In-Game Pause Button
           ============================================ */
        #pauseBtn {
            position: fixed;
            top: 12px;
            right: 12px;
            z-index: 45;
            width: 44px;
            height: 44px;
            font-size: 20px;
            background: rgba(0, 0, 0, 0.4);
            border: 2px solid rgba(255, 255, 255, 0.25);
            border-radius: 8px;
            cursor: pointer;
            color: var(--white);
            display: none;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }

        #pauseBtn:hover {
            background: rgba(0, 255, 255, 0.3);
            border-color: var(--cyan);
        }

        /* Show pause button only during gameplay */
        body:not(.menu-active) #pauseBtn {
            display: flex;
        }

        /* ============================================
           Pause Menu Overlay
           ============================================ */
        #pauseMenu {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 5, 20, 0.85);
            display: none;
            z-index: 3000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(4px);
        }

        #pauseMenu.active {
            display: flex;
        }

        .pause-overlay {
            background: linear-gradient(180deg, rgba(26, 10, 46, 0.98) 0%, rgba(15, 10, 30, 0.99) 100%);
            padding: 28px 36px;
            border-radius: 12px;
            text-align: left;
            border: 3px solid var(--cyan);
            box-shadow:
                0 0 50px rgba(0, 255, 255, 0.3),
                0 0 80px rgba(255, 0, 255, 0.15);
            max-width: 380px;
            width: 85%;
            max-height: 85vh;
            overflow-y: auto;
        }

        .pause-overlay h2 {
            font-family: var(--font-pixel);
            color: var(--cyan);
            font-size: 20px;
            text-align: center;
            margin-bottom: 20px;
            text-shadow: 0 0 20px var(--cyan);
            letter-spacing: 4px;
        }

        .pause-settings-section {
            margin-bottom: 16px;
        }

        .pause-settings-section h3 {
            font-family: var(--font-pixel);
            color: var(--magenta);
            font-size: 10px;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .pause-settings-section .setting-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 6px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.08);
        }

        .pause-settings-section .setting-row label {
            font-family: var(--font-pixel);
            font-size: 9px;
            color: rgba(255, 255, 255, 0.8);
        }

        .pause-settings-section select {
            font-family: var(--font-pixel);
            font-size: 9px;
            background: rgba(0, 0, 0, 0.5);
            color: var(--cyan);
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 4px;
            padding: 4px 6px;
            cursor: pointer;
        }

        .pause-settings-section input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: var(--cyan);
        }

        .pause-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 20px;
        }

        .pause-btn {
            font-family: var(--font-pixel);
            font-size: 12px;
            padding: 14px 20px;
            border: 2px solid;
            border-radius: 6px;
            cursor: pointer;
            letter-spacing: 2px;
            text-align: center;
            transition: all 0.2s ease;
        }

        .pause-btn-resume {
            background: rgba(0, 255, 255, 0.15);
            border-color: var(--cyan);
            color: var(--cyan);
        }

        .pause-btn-resume:hover {
            background: rgba(0, 255, 255, 0.3);
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.4);
        }

        .pause-btn-quit {
            background: rgba(255, 107, 107, 0.1);
            border-color: var(--coral);
            color: var(--coral);
        }

        .pause-btn-quit:hover {
            background: rgba(255, 107, 107, 0.25);
            box-shadow: 0 0 20px rgba(255, 107, 107, 0.3);
        }

        .pause-hint {
            font-family: var(--font-pixel);
            font-size: 8px;
            color: rgba(255, 255, 255, 0.4);
            text-align: center;
            margin-top: 14px;
        }

        /* ============================================
           Responsive Adjustments
           ============================================ */
        @media (max-width: 768px) {
            #game-logo-img {
                max-width: 420px;
            }

            .tagline {
                font-size: 10px;
                letter-spacing: 2px;
                padding: 10px 20px;
            }

            .menu-section {
                max-width: 380px;
            }

            .menu-btn {
                font-size: 14px;
                padding: 16px 32px;
            }

            .btn-primary {
                font-size: 16px;
            }

            .btn-secondary {
                font-size: 12px;
                padding: 14px 22px;
            }

            .mode-btn .mode-name {
                font-size: 12px;
            }

            .mode-btn .mode-desc {
                font-size: 6px;
            }

            .mode-btn .mode-icon {
                font-size: 20px;
            }

            .press-space {
                font-size: 10px;
            }

            #blizzardCanvas {
                width: 550px;
                height: 380px;
            }
        }

        @media (max-width: 520px) {
            #game-logo-img {
                max-width: 300px;
            }

            .tagline {
                font-size: 8px;
                letter-spacing: 1px;
                padding: 8px 14px;
            }

            .menu-section {
                max-width: 320px;
                gap: 12px;
            }

            .menu-btn {
                font-size: 12px;
                padding: 14px 24px;
            }

            .btn-primary {
                font-size: 14px;
            }

            .btn-secondary {
                font-size: 10px;
                padding: 12px 16px;
            }

            .button-row {
                flex-direction: column;
                gap: 10px;
            }

            .press-space {
                font-size: 9px;
            }

            .high-score-display {
                font-size: 11px;
            }

            #blizzardCanvas {
                width: 420px;
                height: 300px;
            }

            .corner-buttons {
                top: 12px;
                right: 12px;
                gap: 8px;
            }

            .corner-btn {
                padding: 8px 10px;
                font-size: 18px;
            }
        }
    </style>
</head>
<body class="menu-active">
    <!-- Start Screen Modal - OUTSIDE game-container to fill viewport -->
    <div id="startScreen" style="position:fixed;top:0;left:0;width:100vw;height:100vh;margin:0;padding:0;border:none;border-radius:0;box-shadow:none;">
            <!-- Corner Buttons: Settings & Fullscreen -->
            <div class="corner-buttons">
                <button onclick="toggleFullscreen()" class="corner-btn corner-fullscreen-btn" aria-label="Toggle fullscreen" title="Fullscreen">‚õ∂</button>
                <button onclick="showSettingsMenu()" class="corner-btn corner-settings-btn" aria-label="Settings" title="Settings">‚öôÔ∏è</button>
            </div>
            <canvas id="snowCanvas"></canvas>
            <div class="content-overlay">
                <!-- Title Section with Wordmark Logo -->
                <div class="title-section">
                    <canvas id="blizzardCanvas" aria-hidden="true"></canvas>
                    <img src="assets/shredordead-wordmark.png" alt="SHRED OR DEAD" id="game-logo-img">
                    <h1 class="visually-hidden">SHRED OR DEAD</h1>
                </div>

                <!-- Spacer for vertical centering -->
                <div style="flex: 1;"></div>

                <!-- Menu Buttons -->
                <div class="menu-section">
                    <p class="tagline">SHRED THE GNAR OR GET WRECKED</p>
                    <!-- Mode Selector -->
                    <div class="mode-selector" id="modeSelector">
                        <button class="mode-btn mode-active" id="modeOG" onclick="selectMode('og')">
                            <span class="mode-icon">üèîÔ∏è</span>
                            <span class="mode-name">OG</span>
                            <span class="mode-desc">Endless shred. Outrun the fog.</span>
                        </button>
                        <button class="mode-btn" id="modeSlalom" onclick="selectMode('slalom')">
                            <span class="mode-icon">‚õ∑Ô∏è</span>
                            <span class="mode-name">SLALOM</span>
                            <span class="mode-desc">Race the gates. Beat the clock.</span>
                        </button>
                    </div>
                    <button class="menu-btn btn-primary" id="startBtn" onclick="startSelectedMode()">
                        START GAME
                    </button>
                    <div class="button-row">
                        <button class="menu-btn btn-secondary" onclick="showHighScores()">
                            HIGH SCORES
                        </button>
                        <button class="menu-btn btn-secondary" onclick="showHowToPlay()">
                            HOW TO PLAY
                        </button>
                    </div>
                    <div class="high-score-display" id="menuHighScore" style="display: none;">
                        BEST: <span id="menuHighScoreValue">0</span>
                    </div>
                    <p class="press-space">PRESS SPACE / TAP / A BUTTON TO START</p>
                </div>
            </div>

            <!-- How To Play Submenu -->
            <div class="submenu" id="howToPlayMenu">
                <h2>HOW TO PLAY</h2>
                <div class="submenu-content">
                    <div class="submenu-section">
                        <h3>OBJECTIVE</h3>
                        <p>Race down the mountain, dodge obstacles, and outrun the avalanche chasing you!</p>
                    </div>
                    <div class="submenu-section">
                        <h3>KEYBOARD</h3>
                        <ul>
                            <li><span class="control-key">LEFT / RIGHT</span> Carve and steer</li>
                            <li><span class="control-key">DOWN</span> Tuck for speed</li>
                            <li><span class="control-key">SPACE</span> Start / Confirm</li>
                        </ul>
                    </div>
                    <div class="submenu-section">
                        <h3>CONTROLLER</h3>
                        <ul>
                            <li><span class="control-key">L STICK / D-PAD</span> Carve and steer</li>
                            <li><span class="control-key">TRIGGERS</span> Tuck for speed</li>
                            <li><span class="control-key">A / START</span> Start / Confirm</li>
                        </ul>
                    </div>
                    <div class="submenu-section">
                        <h3>TOUCH (MOBILE)</h3>
                        <ul>
                            <li><span class="control-key">SWIPE LEFT/RIGHT</span> Carve and steer</li>
                            <li><span class="control-key">SWIPE DOWN</span> Tuck for speed</li>
                            <li><span class="control-key">SWIPE UP</span> Brake / slow down</li>
                            <li><span class="control-key">TAP</span> Start / Confirm</li>
                        </ul>
                    </div>
                    <div class="submenu-section">
                        <h3>TRICKS & SCORING</h3>
                        <ul>
                            <li>Hit jumps to catch air</li>
                            <li>Grind rails for bonus points</li>
                            <li>Chain tricks for combo multipliers</li>
                            <li>Close calls with obstacles = extra points!</li>
                        </ul>
                    </div>
                    <div class="submenu-section">
                        <h3>HAZARDS</h3>
                        <ul>
                            <li>Trees and rocks will wreck you</li>
                            <li>The avalanche is always chasing - don't slow down!</li>
                            <li>Something lurks behind the snow...</li>
                        </ul>
                    </div>
                </div>
                <div class="btn-back">
                    <button onclick="hideHowToPlay()">BACK</button>
                </div>
            </div>

            <!-- High Scores Submenu -->
            <div class="submenu" id="highScoresMenu">
                <h2>HIGH SCORES</h2>
                <div class="submenu-content">
                    <div class="scores-list">
                        <div class="score-item">
                            <span class="score-label">BEST SCORE</span>
                            <span class="score-value" id="hsScore">0</span>
                        </div>
                        <div class="score-item">
                            <span class="score-label">BEST DISTANCE</span>
                            <span class="score-value" id="hsDistance">0m</span>
                        </div>
                        <div class="score-item">
                            <span class="score-label">MAX COMBO</span>
                            <span class="score-value" id="hsCombo">0x</span>
                        </div>
                    </div>
                </div>
                <div class="btn-back">
                    <button onclick="hideHighScores()">BACK</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Game Container - separate from start screen -->
    <div id="game-container">
        <canvas id="gameCanvas" width="480" height="640"></canvas>
        <!-- In-game pause button (touch-friendly) -->
        <button id="pauseBtn" onclick="togglePause()" aria-label="Pause" title="Pause (ESC)">‚è∏</button>
    </div>

    <!-- In-Game Pause Menu Overlay -->
    <div id="pauseMenu">
        <div class="pause-overlay">
            <h2>PAUSED</h2>

            <div class="pause-settings-section">
                <h3>Gameplay</h3>
                <div class="setting-row">
                    <label>Game Speed:</label>
                    <select id="pauseGameSpeed" onchange="setPauseGameSpeed(this.value)">
                        <option value="chill">üèîÔ∏è Chill</option>
                        <option value="normal" selected>üèÇ Normal</option>
                        <option value="insane">üî• Insane</option>
                    </select>
                </div>
                <div class="setting-row">
                    <label>Touch Sensitivity:</label>
                    <select id="pauseTouchSensitivity" onchange="setPauseTouchSensitivity(this.value)">
                        <option value="low">Low</option>
                        <option value="medium" selected>Medium</option>
                        <option value="high">High</option>
                    </select>
                </div>
                <div class="setting-row">
                    <label>Camera Feel:</label>
                    <select id="pauseCameraSmoothing" onchange="setPauseCameraSmoothing(this.value)">
                        <option value="tight">Tight</option>
                        <option value="normal" selected>Normal</option>
                        <option value="smooth">Smooth</option>
                    </select>
                </div>
            </div>

            <div class="pause-settings-section">
                <h3>Effects</h3>
                <div class="setting-row">
                    <label>Screen Shake:</label>
                    <input type="checkbox" id="pauseScreenShake" checked onchange="setPauseScreenShake(this.checked)">
                </div>
                <div class="setting-row">
                    <label>Music:</label>
                    <input type="checkbox" id="pauseMusic" checked onchange="setPauseMusic(this.checked)">
                </div>
            </div>

            <div class="pause-buttons">
                <button class="pause-btn pause-btn-resume" onclick="resumeGame()">RESUME</button>
                <button class="pause-btn pause-btn-quit" onclick="pauseQuitToMenu()">QUIT TO MENU</button>
            </div>

            <p class="pause-hint">ESC / P / START to resume</p>
        </div>
    </div>

    <!-- Slalom Results Screen -->
    <div id="slalomResults" style="display: none;">
        <div class="slalom-results-overlay">
            <h2>SLALOM COMPLETE</h2>
            <div class="slalom-stats">
                <div class="slalom-stat-row">
                    <span class="slalom-stat-label">TIME</span>
                    <span class="slalom-stat-value" id="slalomTime">0:00.0</span>
                </div>
                <div class="slalom-stat-row">
                    <span class="slalom-stat-label">GATES</span>
                    <span class="slalom-stat-value" id="slalomGates">0/0</span>
                </div>
                <div class="slalom-stat-row">
                    <span class="slalom-stat-label">PENALTIES</span>
                    <span class="slalom-stat-value penalty" id="slalomPenalties">+0.0s</span>
                </div>
                <div class="slalom-stat-row final">
                    <span class="slalom-stat-label">FINAL</span>
                    <span class="slalom-stat-value" id="slalomFinal">0:00.0</span>
                </div>
                <div class="slalom-stat-row">
                    <span class="slalom-stat-label">BEST</span>
                    <span class="slalom-stat-value best" id="slalomBest">--:--.-</span>
                </div>
            </div>
            <div id="slalomNewBest" class="slalom-new-best" style="display: none;">NEW BEST TIME!</div>
            <div class="button-row">
                <button class="menu-btn btn-primary" onclick="startSlalom()" style="font-size:12px;padding:14px 20px;">RACE AGAIN</button>
                <button class="menu-btn btn-secondary" onclick="slalomBackToMenu()" style="font-size:12px;padding:14px 20px;">MENU</button>
            </div>
        </div>
    </div>

    <!-- Settings Menu (Global Overlay) -->
    <div id="settingsMenu">
        <div class="settings-overlay">
            <h2>SETTINGS</h2>

            <div class="settings-section">
                <h3>Display</h3>
                <div class="setting-row">
                    <label>Device:</label>
                    <span id="deviceProfileLabel" class="device-info">Detecting...</span>
                </div>
                <div class="setting-row">
                    <label>Auto Detect:</label>
                    <input type="checkbox" id="autoDetectToggle" checked onchange="toggleAutoDetect(this.checked)">
                </div>
                <div class="setting-row">
                    <label>Resolution:</label>
                    <select id="resolutionSelect" onchange="changeResolution(this.value)">
                        <optgroup label="Portrait (3:4)">
                            <option value="480x640">480√ó640 (1x)</option>
                            <option value="600x800">600√ó800 (1.25x)</option>
                            <option value="720x960">720√ó960 (1.5x)</option>
                            <option value="768x1024">768√ó1024 (1.6x)</option>
                            <option value="900x1200">900√ó1200 (1.875x)</option>
                        </optgroup>
                        <optgroup label="Mobile Portrait (9:16)">
                            <option value="405x720">405√ó720</option>
                            <option value="608x1080">608√ó1080</option>
                        </optgroup>
                        <optgroup label="Steam Deck Portrait (10:16)">
                            <option value="500x800">500√ó800</option>
                        </optgroup>
                        <optgroup label="Widescreen HD (16:9)">
                            <option value="854x480">854√ó480 (720p Base)</option>
                            <option value="1280x720">1280√ó720 (HD)</option>
                            <option value="1920x1080">1920√ó1080 (Full HD)</option>
                        </optgroup>
                        <optgroup label="Steam Deck Landscape (16:10)">
                            <option value="1280x800">1280√ó800 (Native)</option>
                        </optgroup>
                        <optgroup label="ROG Ally / Ally X">
                            <option value="1920x1080-ally">1920√ó1080 (Native)</option>
                        </optgroup>
                    </select>
                </div>
                <div class="setting-row">
                    <label>Fullscreen:</label>
                    <button onclick="toggleFullscreen()">Toggle (F11)</button>
                </div>
                <div class="setting-row">
                    <label>Fill Screen:</label>
                    <input type="checkbox" id="fillScreenToggle" checked onchange="toggleFillScreen(this.checked)">
                    <span style="font-size: 10px; opacity: 0.7; margin-left: 8px;">(Adapts to screen size)</span>
                </div>
            </div>

            <div class="settings-section">
                <h3>Gameplay</h3>
                <div class="setting-row">
                    <label>Game Speed:</label>
                    <select id="gameSpeedSelect" onchange="changeGameSpeed(this.value)">
                        <option value="chill">üèîÔ∏è Chill</option>
                        <option value="normal" selected>üèÇ Normal</option>
                        <option value="insane">üî• Insane</option>
                    </select>
                </div>
                <div class="setting-row">
                    <label>Touch Sensitivity:</label>
                    <select id="touchSensitivitySelect" onchange="changeTouchSensitivity(this.value)">
                        <option value="low">Low</option>
                        <option value="medium" selected>Medium</option>
                        <option value="high">High</option>
                    </select>
                </div>
                <div class="setting-row">
                    <label>Camera Feel:</label>
                    <select id="cameraSmoothingSelect" onchange="changeCameraSmoothing(this.value)">
                        <option value="tight">Tight</option>
                        <option value="normal" selected>Normal</option>
                        <option value="smooth">Smooth</option>
                    </select>
                </div>
            </div>

            <div class="settings-section">
                <h3>Game Feel</h3>
                <div class="setting-row">
                    <label>Screen Shake:</label>
                    <input type="checkbox" id="screenShakeToggle" checked onchange="toggleScreenShakeSetting(this.checked)">
                </div>
                <div class="setting-row">
                    <label>Controller Haptics:</label>
                    <input type="checkbox" id="hapticsToggle" checked onchange="toggleHapticsSetting(this.checked)">
                </div>
                <div class="setting-row">
                    <label>Stance:</label>
                    <select id="stanceSelect" onchange="setStance(this.value)">
                        <option value="regular">Regular (left foot forward)</option>
                        <option value="goofy">Goofy (right foot forward)</option>
                    </select>
                </div>
            </div>

            <div class="settings-section">
                <h3>Audio</h3>
                <div class="setting-row">
                    <label>Music:</label>
                    <input type="checkbox" id="musicToggle" checked onchange="toggleMusic(this.checked)">
                </div>
            </div>

            <div class="settings-section">
                <h3>Controller</h3>
                <div class="setting-row">
                    <label>Gamepad:</label>
                    <span id="gamepadStatus" style="color: #ff6b6b;">Not Connected</span>
                </div>
                <div class="setting-row" style="flex-direction: column; align-items: flex-start; gap: 8px;">
                    <div style="display: flex; gap: 15px;">
                        <span style="color: var(--magenta);">Left Stick / D-Pad</span>
                        <span style="opacity: 0.7;">Carve</span>
                    </div>
                    <div style="display: flex; gap: 15px;">
                        <span style="color: var(--magenta);">Triggers / Bumpers</span>
                        <span style="opacity: 0.7;">Tuck (Speed)</span>
                    </div>
                    <div style="display: flex; gap: 15px;">
                        <span style="color: var(--magenta);">A / Start</span>
                        <span style="opacity: 0.7;">Start / Confirm</span>
                    </div>
                </div>
            </div>

            <div class="settings-section">
                <h3>Keyboard</h3>
                <div class="setting-row" style="flex-direction: column; align-items: flex-start; gap: 8px;">
                    <div style="display: flex; gap: 15px;">
                        <span style="color: var(--cyan);">‚Üê/‚Üí or A/D</span>
                        <span style="opacity: 0.7;">Carve</span>
                    </div>
                    <div style="display: flex; gap: 15px;">
                        <span style="color: var(--cyan);">‚Üì or S</span>
                        <span style="opacity: 0.7;">Tuck (Speed)</span>
                    </div>
                    <div style="display: flex; gap: 15px;">
                        <span style="color: var(--cyan);">SPACE</span>
                        <span style="opacity: 0.7;">Start / Confirm</span>
                    </div>
                </div>
            </div>

            <div class="settings-buttons">
                <button class="btn-reset" onclick="resetAllSettings()">RESET</button>
                <button class="btn-back" onclick="hideSettingsMenu()">BACK</button>
            </div>
        </div>
    </div>

    <!-- Snow Particle System -->
    <script>
        // Snow particle system for start screen - optimized with delta-time and object pooling
        (function() {
            const snowCanvas = document.getElementById('snowCanvas');
            const ctx = snowCanvas.getContext('2d');
            let particles = [];
            const MAX_PARTICLES = 30;
            let lastTime = performance.now();
            let initialized = false;

            function resizeCanvas() {
                const container = document.getElementById('startScreen');
                snowCanvas.width = container.offsetWidth;
                snowCanvas.height = container.offsetHeight;
            }

            // Create snowflake with optional random Y for initialization
            function createSnowflake(randomY = false) {
                return {
                    x: Math.random() * snowCanvas.width,
                    y: randomY ? Math.random() * snowCanvas.height : -10 - Math.random() * 50,
                    size: Math.random() * 3 + 1.5,
                    speed: Math.random() * 0.8 + 0.3,
                    drift: (Math.random() - 0.5) * 0.5,
                    wobble: Math.random() * Math.PI * 2,
                    wobbleSpeed: Math.random() * 0.015 + 0.005,
                    opacity: Math.random() * 0.4 + 0.2
                };
            }

            // Reset particle position (object pooling)
            function resetSnowflake(p) {
                p.x = Math.random() * snowCanvas.width;
                p.y = -10 - Math.random() * 30;
                p.size = Math.random() * 3 + 1.5;
                p.speed = Math.random() * 0.8 + 0.3;
                p.drift = (Math.random() - 0.5) * 0.5;
                p.wobble = Math.random() * Math.PI * 2;
                p.wobbleSpeed = Math.random() * 0.015 + 0.005;
                p.opacity = Math.random() * 0.4 + 0.2;
            }

            // Initialize particles distributed across screen
            function initParticles() {
                particles = [];
                for (let i = 0; i < MAX_PARTICLES; i++) {
                    particles.push(createSnowflake(true));
                }
                initialized = true;
            }

            function updateParticles(dt) {
                const speedMultiplier = dt * 60;

                for (let i = 0; i < particles.length; i++) {
                    const p = particles[i];

                    p.y += p.speed * speedMultiplier;
                    p.wobble += p.wobbleSpeed * speedMultiplier;
                    p.x += (p.drift + Math.sin(p.wobble) * 0.2) * speedMultiplier;

                    // Reset particles that fall off screen
                    if (p.y > snowCanvas.height + 10) {
                        resetSnowflake(p);
                    }

                    // Wrap horizontally
                    if (p.x < -10) p.x = snowCanvas.width + 10;
                    if (p.x > snowCanvas.width + 10) p.x = -10;
                }
            }

            function drawParticles() {
                ctx.clearRect(0, 0, snowCanvas.width, snowCanvas.height);

                for (let i = 0; i < particles.length; i++) {
                    const p = particles[i];

                    ctx.beginPath();
                    ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                    ctx.fillStyle = `rgba(255, 255, 255, ${p.opacity})`;
                    ctx.fill();
                }
            }

            function animate(currentTime) {
                const startScreen = document.getElementById('startScreen');
                if (startScreen && startScreen.style.display !== 'none') {
                    const dt = Math.min((currentTime - lastTime) / 1000, 0.1);
                    lastTime = currentTime;

                    if (!initialized) {
                        initParticles();
                    }

                    updateParticles(dt);
                    drawParticles();
                }
                requestAnimationFrame(animate);
            }

            // Initialize
            window.addEventListener('load', () => {
                resizeCanvas();
                lastTime = performance.now();
                requestAnimationFrame(animate);
            });

            window.addEventListener('resize', () => {
                resizeCanvas();
                if (initialized) {
                    initParticles();
                }
            });
        })();

        // ============================================
        // BLIZZARD PARTICLE SYSTEM
        // Snowflakes swirl around the logo perimeter
        // Cast in neon cyan/magenta light
        // ============================================
        (function() {
            const canvas = document.getElementById('blizzardCanvas');
            if (!canvas) return;

            const ctx = canvas.getContext('2d');
            const particles = [];
            const maxParticles = 30;

            // Set canvas size - matches CSS dimensions
            function resizeCanvas() {
                // Get the computed style to match CSS
                const computedStyle = window.getComputedStyle(canvas);
                canvas.width = parseInt(computedStyle.width) || 750;
                canvas.height = parseInt(computedStyle.height) || 450;
            }
            resizeCanvas();

            // Logo dimensions - centered, scaled with canvas
            let centerX = canvas.width / 2;
            let centerY = canvas.height * 0.35;
            let logoWidth = Math.min(500, canvas.width * 0.7);
            let logoHeight = logoWidth * 0.22;

            // Update dimensions when canvas resizes
            function updateLogoDimensions() {
                centerX = canvas.width / 2;
                centerY = canvas.height * 0.35;
                logoWidth = Math.min(500, canvas.width * 0.7);
                logoHeight = logoWidth * 0.22;
            }

            // Random helpers
            function rand(min, max) {
                return Math.random() * (max - min) + min;
            }
            function randInt(min, max) {
                return Math.floor(rand(min, max + 1));
            }

            // Neon snow colors - icy blues, whites, and magenta/cyan highlights
            const snowColors = [
                // Pure white/ice
                { h: [180, 200], s: [5, 20], l: [92, 99] },
                // Cyan-tinted ice
                { h: [175, 195], s: [60, 90], l: [80, 95] },
                // Magenta-tinted
                { h: [280, 310], s: [50, 80], l: [80, 92] },
                // Electric cyan
                { h: [180, 190], s: [90, 100], l: [60, 80] },
                // Hot magenta
                { h: [290, 320], s: [85, 100], l: [65, 85] },
                // Pale blue
                { h: [200, 220], s: [40, 70], l: [85, 95] },
                // Pure white
                { h: [0, 360], s: [0, 10], l: [95, 100] },
            ];

            // Get spawn point on logo perimeter (uses current logo dimensions)
            function getPerimeterSpawn() {
                // Calculate current logo bounds
                const logoLeft = centerX - logoWidth / 2;
                const logoRight = centerX + logoWidth / 2;
                const logoTop = centerY - logoHeight / 2;
                const logoBottom = centerY + logoHeight / 2;
                const edgeRoll = Math.random();
                let edge;
                if (edgeRoll < 0.30) edge = 'top';
                else if (edgeRoll < 0.50) edge = 'right';
                else if (edgeRoll < 0.75) edge = 'bottom';
                else edge = 'left';

                let x, y, normalAngle;
                const edgeOffset = 6;

                switch (edge) {
                    case 'top':
                        x = logoLeft + Math.random() * logoWidth;
                        y = logoTop - edgeOffset;
                        normalAngle = -Math.PI/2 + rand(-0.3, 0.3);
                        break;
                    case 'right':
                        x = logoRight + edgeOffset;
                        y = logoTop + Math.random() * logoHeight;
                        normalAngle = rand(-0.4, 0.4);
                        break;
                    case 'bottom':
                        x = logoLeft + Math.random() * logoWidth;
                        y = logoBottom + edgeOffset;
                        normalAngle = Math.PI/2 + rand(-0.3, 0.3);
                        break;
                    case 'left':
                        x = logoLeft - edgeOffset;
                        y = logoTop + Math.random() * logoHeight;
                        normalAngle = Math.PI + rand(-0.4, 0.4);
                        break;
                }

                return { x, y, angle: normalAngle, edge };
            }

            // Create a new snowflake
            function createSnowflake() {
                const spawn = getPerimeterSpawn();

                // Pick random color - weighted towards neon
                const colorIdx = Math.random() > 0.4
                    ? randInt(1, 4)  // More neon colors
                    : randInt(0, snowColors.length - 1);
                const color = snowColors[colorIdx];

                // Size variety
                const sizeCategory = Math.random();
                let initialSize;
                if (sizeCategory > 0.92) {
                    initialSize = rand(8, 14); // Large flakes
                } else if (sizeCategory > 0.7) {
                    initialSize = rand(5, 8);  // Medium
                } else if (sizeCategory > 0.35) {
                    initialSize = rand(3, 5);  // Small
                } else {
                    initialSize = rand(1.5, 3); // Tiny ice crystals
                }

                // Speed - larger = slower
                const baseSpeed = rand(1.2, 3.5);
                const speed = baseSpeed * (initialSize > 8 ? 0.5 : initialSize > 5 ? 0.7 : 1.0);

                // Velocity outward
                const spreadAngle = spawn.angle + rand(-0.6, 0.6);
                const vx = Math.cos(spreadAngle) * speed;
                const vy = Math.sin(spreadAngle) * speed;

                return {
                    x: spawn.x,
                    y: spawn.y,
                    spawnX: spawn.x,
                    spawnY: spawn.y,
                    vx: vx * rand(0.8, 1.2),
                    vy: vy * rand(0.8, 1.2),

                    initialSize: initialSize,
                    size: initialSize,

                    // Rotation for snowflake appearance
                    rotation: rand(-Math.PI, Math.PI),
                    rotationSpeed: rand(-0.1, 0.1) * (initialSize > 6 ? 0.4 : 1),

                    // Life
                    life: 1,

                    // Color
                    hue: rand(color.h[0], color.h[1]),
                    sat: rand(color.s[0], color.s[1]),
                    light: rand(color.l[0], color.l[1]),

                    // Motion
                    wobble: rand(0, Math.PI * 2),
                    wobbleSpeed: rand(0.04, 0.12),
                    wobbleAmp: rand(0.2, 0.8),

                    // Sparkle
                    sparkle: rand(0, Math.PI * 2),
                    sparkleSpeed: rand(0.15, 0.4),
                    // Physics
                    drag: rand(0.985, 0.995),
                    gravity: rand(-0.008, 0.015),
                };
            }

            // Spawn particles
            let spawnAcc = 0;
            function spawnParticles(dt) {
                let rate = 18;
                if (Math.random() > 0.94) rate *= 4; // Burst!
                else if (Math.random() > 0.85) rate *= 2;

                spawnAcc += rate * dt;
                while (spawnAcc >= 1 && particles.length < maxParticles) {
                    particles.push(createSnowflake());
                    spawnAcc -= 1;
                }
            }

            // Update particles
            function updateParticles(dt) {
                for (let i = particles.length - 1; i >= 0; i--) {
                    const p = particles[i];
                    // Wobble/swirl motion
                    p.wobble += p.wobbleSpeed;
                    const wobble = Math.sin(p.wobble) * p.wobbleAmp;

                    // Update position
                    p.x += p.vx + wobble;
                    p.y += p.vy;

                    // Apply drag and gravity
                    p.vx *= p.drag;
                    p.vy *= p.drag;
                    p.vy += p.gravity;

                    // Tiny drift
                    p.vx += rand(-0.02, 0.02);
                    p.vy += rand(-0.01, 0.01);

                    // Rotation
                    p.rotation += p.rotationSpeed;

                    // Sparkle
                    p.sparkle += p.sparkleSpeed;

                    // Distance from spawn
                    const dx = p.x - p.spawnX;
                    const dy = p.y - p.spawnY;
                    const distance = Math.sqrt(dx * dx + dy * dy);

                    // Fade out based on distance
                    const maxDistance = 120 + p.initialSize * 8;
                    const distanceRatio = Math.min(1, distance / maxDistance);
                    p.size = p.initialSize * (1 - distanceRatio * 0.8);
                    p.life = Math.max(0, 1 - distanceRatio);

                    // Remove dead particles
                    if (p.life <= 0.02 || p.size < 0.5 || distance > maxDistance * 1.2) {
                        particles.splice(i, 1);
                    }
                }
            }

            // Draw snowflake
            function drawSnowflake(p) {
                const sparkleMod = 0.7 + Math.sin(p.sparkle) * 0.3;
                const alpha = p.life * sparkleMod;
                if (alpha < 0.03) return;

                ctx.save();
                ctx.translate(p.x, p.y);
                ctx.rotate(p.rotation);

                const color = `hsla(${p.hue}, ${p.sat}%, ${p.light}%, ${alpha})`;
                ctx.fillStyle = color;
                ctx.beginPath();
                ctx.arc(0, 0, Math.max(1, p.size), 0, Math.PI * 2);
                ctx.fill();

                // Small bright core for larger flakes
                if (p.size > 5 && alpha > 0.4) {
                    ctx.fillStyle = `hsla(0, 0%, 100%, ${alpha * 0.8})`;
                    ctx.beginPath();
                    ctx.arc(0, 0, p.size * 0.2, 0, Math.PI * 2);
                    ctx.fill();
                }

                ctx.restore();
            }

            // Render loop
            let lastTime = performance.now();

            function animate(currentTime) {
                const startScreen = document.getElementById('startScreen');
                if (startScreen && startScreen.style.display !== 'none') {
                    const dt = Math.min((currentTime - lastTime) / 1000, 0.1);
                    lastTime = currentTime;

                    ctx.clearRect(0, 0, canvas.width, canvas.height);

                    spawnParticles(dt);
                    updateParticles(dt);

                    // Draw all snowflakes
                    for (const p of particles) {
                        drawSnowflake(p);
                    }
                }

                requestAnimationFrame(animate);
            }

            // Start animation
            window.addEventListener('load', () => {
                resizeCanvas();
                updateLogoDimensions();
                requestAnimationFrame(animate);
            });

            window.addEventListener('resize', () => {
                resizeCanvas();
                updateLogoDimensions();
            });
        })();

        // Menu functions
        function showStartScreen() {
            document.getElementById('startScreen').style.display = 'block';
            document.body.classList.add('menu-active');
            updateMenuHighScore();
        }

        function hideStartScreen() {
            document.getElementById('startScreen').style.display = 'none';
            document.body.classList.remove('menu-active');
        }

        function showHowToPlay() {
            document.getElementById('howToPlayMenu').classList.add('active');
        }

        function hideHowToPlay() {
            document.getElementById('howToPlayMenu').classList.remove('active');
        }

        function showHighScores() {
            updateHighScoreDisplay();
            document.getElementById('highScoresMenu').classList.add('active');
        }

        function hideHighScores() {
            document.getElementById('highScoresMenu').classList.remove('active');
        }

        function updateMenuHighScore() {
            const saved = localStorage.getItem('shredordead_highscore');
            const highScore = saved ? parseInt(saved, 10) : 0;
            const display = document.getElementById('menuHighScore');
            const value = document.getElementById('menuHighScoreValue');

            if (highScore > 0) {
                display.style.display = 'block';
                value.textContent = highScore.toLocaleString();
            } else {
                display.style.display = 'none';
            }
        }

        function updateHighScoreDisplay() {
            const saved = localStorage.getItem('shredordead_highscore');
            const highScore = saved ? parseInt(saved, 10) : 0;

            // For now, we only track high score - distance and combo would need separate storage
            document.getElementById('hsScore').textContent = highScore.toLocaleString();

            // These would be populated if we tracked them separately
            const savedDistance = localStorage.getItem('shredordead_bestdistance');
            const savedCombo = localStorage.getItem('shredordead_maxcombo');

            document.getElementById('hsDistance').textContent = savedDistance ? savedDistance + 'm' : '0m';
            document.getElementById('hsCombo').textContent = savedCombo ? savedCombo + 'x' : '0x';
        }

        // Initialize menu high score on load
        window.addEventListener('load', updateMenuHighScore);
    </script>

    <script src="game.js?v=3"></script>
</body>
</html>
